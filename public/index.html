<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Andrew's B&B</title>
  <style>
    :root{
      --bg0:#0b0c10;
      --bg1:#0f1117;
      --panel:rgba(20,22,30,.72);
      --panel2:rgba(20,22,30,.55);
      --stroke:rgba(255,255,255,.08);
      --gold:#d7b46a;
      --text:#e9ecf1;
      --muted:#b7bdc9;
      --accent:#7b0018;
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --r:22px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 20% 0%, rgba(123,0,24,.35), transparent 60%),
        radial-gradient(1200px 800px at 80% 10%, rgba(215,180,106,.18), transparent 55%),
        linear-gradient(180deg, #0a0b0f, #07080c);
      min-height:100vh;
    }

    /* FULL WIDTH, FILLED LOOK */
    .wrap{
      width:min(1500px, 96vw);
      margin: 18px auto 60px;
    }

    /* TOP: centered logo only */
    header{
      display:flex;
      justify-content:center;
      align-items:center;
      padding: 18px 10px 8px;
    }
    .brand{
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
      letter-spacing:.5px;
      font-weight:700;
      font-size: clamp(28px, 3vw, 44px);
      color: var(--gold);
      text-shadow: 0 10px 40px rgba(215,180,106,.15);
    }

    /* THUMB STRIP (bigger + slower) */
    .thumbBar{
      position:relative;
      margin: 12px auto 20px;
      padding: 16px 64px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .thumbRail{
      display:flex;
      gap:18px;
      overflow-x:auto;
      scroll-behavior:smooth;
      padding-bottom:6px;
      scrollbar-width:none;
    }
    .thumbRail::-webkit-scrollbar{display:none}
    .thumb{
      min-width: 240px;
      height: 130px;
      border-radius: 18px;
      position:relative;
      overflow:hidden;
      cursor:pointer;
      background:#13151d;
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      transform: translateZ(0);
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      filter:saturate(1.05) contrast(1.02);
      transform: scale(1.02);
    }
    .thumb .label{
      position:absolute;
      left:10px;
      bottom:10px;
      font-weight:700;
      text-shadow: 0 10px 30px rgba(0,0,0,.6);
      display:flex;
      gap:10px;
      align-items:baseline;
    }
    .thumb .price{
      position:absolute;
      right:10px;
      bottom:10px;
      font-size: 12px;
      color: rgba(255,255,255,.85);
      text-shadow: 0 10px 30px rgba(0,0,0,.6);
    }
    .thumb.active{
      outline: 2px solid rgba(215,180,106,.75);
      box-shadow: 0 18px 60px rgba(215,180,106,.08), 0 10px 40px rgba(0,0,0,.45);
    }

    .barArrow{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:44px;
      height:44px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(12,13,18,.55);
      color: var(--text);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, background .12s ease;
      z-index:5;
    }
    .barArrow:hover{ background: rgba(12,13,18,.75); transform: translateY(-50%) scale(1.03); }
    .barArrow.left{ left:14px; }
    .barArrow.right{ right:14px; }

    /* ROOMS LIST */
    .rooms{
      display:flex;
      flex-direction:column;
      gap: 26px;
    }

    /* WIDER “BARS” LIKE YOUR PIC */
    .roomCard{
      border-radius: 26px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .roomInner{
      display:grid;
      grid-template-columns: 1.35fr 1fr;
      gap: 22px;            /* space between photo and calendar/info */
      padding: 20px;
      background:
        radial-gradient(900px 500px at 20% 0%, rgba(123,0,24,.25), transparent 60%),
        linear-gradient(180deg, rgba(10,11,15,.35), rgba(10,11,15,.12));
    }

    @media (max-width: 980px){
      .roomInner{ grid-template-columns: 1fr; }
      .thumb{ min-width: 200px; height: 120px; }
      .thumbBar{ padding:16px 56px; }
    }

    /* PHOTO SIDE (carousel) */
    .photo{
      position:relative;
      border-radius: 22px;
      overflow:hidden;
      background: #0e1016;
      min-height: 420px;
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
    }
    .photo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transform: scale(1.01);
    }
    .pArrow{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:44px;height:44px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(10,11,15,.55);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      color: var(--text);
      transition: transform .12s ease, background .12s ease;
    }
    .pArrow:hover{ background: rgba(10,11,15,.78); transform: translateY(-50%) scale(1.03); }
    .pArrow.left{ left:14px; }
    .pArrow.right{ right:14px; }

    .photoBadge{
      position:absolute;
      left:14px; bottom:14px;
      padding:10px 12px;
      border-radius: 999px;
      background: rgba(10,11,15,.55);
      border: 1px solid rgba(255,255,255,.12);
      font-size: 13px;
      color: rgba(255,255,255,.92);
      backdrop-filter: blur(8px);
    }

    /* INFO SIDE */
    .infoSide{
      display:flex;
      flex-direction:column;
      gap: 14px;
    }
    .titleRow{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
    }
    .roomTitle{
      font-size: 34px;
      margin: 0;
      letter-spacing:.2px;
    }
    .pricePill{
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(215,180,106,.10);
      border: 1px solid rgba(215,180,106,.25);
      color: rgba(255,255,255,.95);
      font-weight:700;
      white-space:nowrap;
    }
    .subBox{
      padding: 14px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.09);
      color: rgba(255,255,255,.92);
    }
    .subBox b{ color: var(--text); }

    /* calendar panel – wide bar look */
    .calWrap{
      padding: 14px;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(10,11,15,.65), rgba(10,11,15,.45));
      border: 1px solid rgba(255,255,255,.08);
    }
    .calTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .calMonth{
      font-weight:800;
      font-size: 16px;
      letter-spacing:.3px;
    }
    .calNav{
      display:flex; gap:10px;
    }
    .iconBtn{
      width:34px;height:34px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
    }
    .dow{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap:8px;
      margin: 8px 0 10px;
      color: rgba(255,255,255,.7);
      font-size: 12px;
      font-weight:700;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }
    .day{
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      font-weight:700;
      color: rgba(255,255,255,.9);
    }
    .day.muted{
      opacity:.35;
      cursor:default;
    }
    .day.disabled{
      opacity:.28;
      cursor:not-allowed;
      text-decoration: line-through;
    }
    .day.selected{
      background: rgba(215,180,106,.18);
      border-color: rgba(215,180,106,.35);
    }
    .day.inRange{
      background: rgba(215,180,106,.10);
      border-color: rgba(215,180,106,.18);
    }

    .rangeRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    .pill{
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      font-size: 13px;
      min-height: 44px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .pill strong{ font-size: 14px; }

    .actions{
      display:flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap:wrap;
    }
    .btn{
      border:none;
      cursor:pointer;
      padding: 12px 14px;
      border-radius: 14px;
      font-weight:800;
      letter-spacing:.2px;
    }
    .btn.secondary{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--text);
    }
    .btn.primary{
      background: linear-gradient(180deg, rgba(215,180,106,.95), rgba(165,132,66,.95));
      color: #13151d;
      box-shadow: 0 16px 45px rgba(215,180,106,.18);
    }

    .hint{
      margin-top: 10px;
      color: rgba(255,255,255,.72);
      font-size: 12.5px;
      line-height: 1.35;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand" id="brand">Andrew's B&amp;B</div>
    </header>

    <section class="thumbBar" aria-label="Room thumbnails">
      <div class="barArrow left" id="thumbLeft" title="Scroll left">‹</div>
      <div class="barArrow right" id="thumbRight" title="Scroll right">›</div>
      <div class="thumbRail" id="thumbRail"></div>
    </section>

    <main class="rooms" id="rooms"></main>
  </div>

<script>
/* ===============================
   Data + helpers
================================ */
let DATA = null;

const fmtMoney = (n, sym="$") => `${sym}${n}/night`;
const pad = (n) => String(n).padStart(2,'0');
const iso = (d) => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
const parseISO = (s) => {
  const [y,m,d] = s.split('-').map(Number);
  return new Date(y, m-1, d);
};
const daysBetween = (a,b) => Math.round((b-a)/(1000*60*60*24));

function clampDate(d){
  // normalize to midnight local
  return new Date(d.getFullYear(), d.getMonth(), d.getDate());
}

/* ===============================
   Thumbnail slow auto-scroll
================================ */
function startSlowThumbAutopan(){
  const rail = document.getElementById('thumbRail');
  let dir = 1;
  let raf = null;
  const speed = 0.18; // << slower
  function tick(){
    if (!rail) return;
    rail.scrollLeft += speed * dir;
    const max = rail.scrollWidth - rail.clientWidth - 2;
    if (rail.scrollLeft >= max) dir = -1;
    if (rail.scrollLeft <= 0) dir = 1;
    raf = requestAnimationFrame(tick);
  }
  raf = requestAnimationFrame(tick);

  // pause on hover/touch
  let paused = false;
  const pause = ()=>{ if(paused) return; paused=true; cancelAnimationFrame(raf); };
  const resume = ()=>{ if(!paused) return; paused=false; raf=requestAnimationFrame(tick); };
  rail.addEventListener('mouseenter', pause);
  rail.addEventListener('mouseleave', resume);
  rail.addEventListener('touchstart', pause, {passive:true});
  rail.addEventListener('touchend', resume, {passive:true});
}

/* ===============================
   Calendar component per room
================================ */
function createCalendar(root, room){
  const state = {
    month: new Date(new Date().getFullYear(), new Date().getMonth(), 1),
    start: null,
    end: null
  };

  const bookedSet = new Set(room.booked || []);

  const el = document.createElement('div');
  el.className = 'calWrap';
  el.innerHTML = `
    <div class="calTop">
      <div class="calMonth"></div>
      <div class="calNav">
        <button class="iconBtn prev" aria-label="Previous month">‹</button>
        <button class="iconBtn next" aria-label="Next month">›</button>
      </div>
    </div>
    <div class="dow">
      <div>Mo</div><div>Tu</div><div>We</div><div>Th</div><div>Fr</div><div>Sa</div><div>Su</div>
    </div>
    <div class="grid"></div>

    <div class="rangeRow">
      <div class="pill"><strong>Start</strong><span class="startVal">—</span></div>
      <div class="pill"><strong>End</strong><span class="endVal">—</span></div>
    </div>

    <div class="actions">
      <button class="btn secondary clear">Clear</button>
      <button class="btn primary book" disabled>Book now</button>
    </div>

    <div class="hint">
      Booked dates are disabled. Your selection highlights the chosen range and shows number of nights.
      (Demo only — connect to your real booking backend later.)
    </div>
  `;

  const monthLabel = el.querySelector('.calMonth');
  const grid = el.querySelector('.grid');
  const startVal = el.querySelector('.startVal');
  const endVal = el.querySelector('.endVal');
  const btnPrev = el.querySelector('.prev');
  const btnNext = el.querySelector('.next');
  const btnClear = el.querySelector('.clear');
  const btnBook = el.querySelector('.book');

  function monthName(d){
    return d.toLocaleString(undefined, {month:'long', year:'numeric'});
  }

  function isDisabledDate(dateObj){
    const s = iso(dateObj);
    return bookedSet.has(s);
  }

  function render(){
    monthLabel.textContent = monthName(state.month);

    // build a Monday-first calendar grid
    grid.innerHTML = '';

    const first = new Date(state.month.getFullYear(), state.month.getMonth(), 1);
    const last = new Date(state.month.getFullYear(), state.month.getMonth()+1, 0);

    // JS getDay: Sun=0..Sat=6. Convert to Monday=0..Sunday=6
    const firstDow = (first.getDay() + 6) % 7;
    const daysInMonth = last.getDate();

    // leading blanks
    for(let i=0;i<firstDow;i++){
      const blank = document.createElement('div');
      blank.className = 'day muted';
      blank.textContent = '';
      grid.appendChild(blank);
    }

    for(let day=1; day<=daysInMonth; day++){
      const d = new Date(state.month.getFullYear(), state.month.getMonth(), day);
      const cell = document.createElement('div');
      cell.className = 'day';
      cell.textContent = day;

      const disabled = isDisabledDate(d);
      if(disabled) cell.classList.add('disabled');

      // selection highlighting
      if(state.start && iso(d) === iso(state.start)) cell.classList.add('selected');
      if(state.end && iso(d) === iso(state.end)) cell.classList.add('selected');

      if(state.start && state.end){
        const di = clampDate(d).getTime();
        const si = clampDate(state.start).getTime();
        const ei = clampDate(state.end).getTime();
        if(di > si && di < ei) cell.classList.add('inRange');
      }

      cell.addEventListener('click', ()=>{
        if(disabled) return;

        // pick start then end, or reset logic
        if(!state.start || (state.start && state.end)){
          state.start = d;
          state.end = null;
        } else {
          // enforce end > start
          if(clampDate(d) <= clampDate(state.start)){
            state.start = d;
            state.end = null;
          } else {
            // ensure no disabled dates in between
            const ok = rangeHasNoBooked(state.start, d);
            if(!ok){
              alert('That range includes booked dates. Please choose different dates.');
              return;
            }
            state.end = d;
          }
        }
        syncLabels();
        render();
      });

      grid.appendChild(cell);
    }

    // trailing blanks to complete row
    const totalCells = grid.children.length;
    const trailing = (7 - (totalCells % 7)) % 7;
    for(let i=0;i<trailing;i++){
      const blank = document.createElement('div');
      blank.className = 'day muted';
      blank.textContent = '';
      grid.appendChild(blank);
    }
  }

  function rangeHasNoBooked(a,b){
    const start = clampDate(a);
    const end = clampDate(b);
    const n = daysBetween(start, end);
    for(let i=0;i<=n;i++){
      const d = new Date(start.getFullYear(), start.getMonth(), start.getDate()+i);
      if(isDisabledDate(d)) return false;
    }
    return true;
  }

  function syncLabels(){
    startVal.textContent = state.start ? iso(state.start) : '—';
    endVal.textContent = state.end ? iso(state.end) : '—';

    if(state.start && state.end){
      const nights = daysBetween(clampDate(state.start), clampDate(state.end));
      btnBook.disabled = false;
      btnBook.textContent = `Book now • ${nights} night${nights===1?'':'s'}`;
    } else {
      btnBook.disabled = true;
      btnBook.textContent = 'Book now';
    }
  }

  btnPrev.addEventListener('click', ()=>{
    state.month = new Date(state.month.getFullYear(), state.month.getMonth()-1, 1);
    render();
  });
  btnNext.addEventListener('click', ()=>{
    state.month = new Date(state.month.getFullYear(), state.month.getMonth()+1, 1);
    render();
  });
  btnClear.addEventListener('click', ()=>{
    state.start = null;
    state.end = null;
    syncLabels();
    render();
  });
  btnBook.addEventListener('click', ()=>{
    if(!state.start || !state.end) return;
    const url = new URL('checkout.html', window.location.href);
    url.searchParams.set('roomId', room.id);
    url.searchParams.set('start', iso(state.start));
    url.searchParams.set('end', iso(state.end));
    window.location.href = url.toString();
  });

  syncLabels();
  render();
  root.appendChild(el);
}

/* ===============================
   Room cards render
================================ */
function renderRooms(){
  const rail = document.getElementById('thumbRail');
  const roomsEl = document.getElementById('rooms');
  const brandEl = document.getElementById('brand');

  brandEl.textContent = DATA.brand || "Andrew's B&B";
  roomsEl.innerHTML = '';
  rail.innerHTML = '';

  DATA.rooms.forEach((room, idx)=>{
    // Thumbnails
    const t = document.createElement('div');
    t.className = 'thumb' + (idx===0 ? ' active' : '');
    const img0 = room.images?.[0] || '';
    t.innerHTML = `
      ${img0 ? `<img src="${img0}" alt="${room.name} thumbnail">` : ''}
      <div class="label">
        <span>${room.name}</span>
      </div>
      <div class="price">${fmtMoney(room.pricePerNight, DATA.currencySymbol || '$')}</div>
    `;
    t.addEventListener('click', ()=>{
      document.querySelectorAll('.thumb').forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      document.getElementById(`card-${room.id}`)?.scrollIntoView({behavior:'smooth', block:'start'});
    });
    rail.appendChild(t);

    // Room card
    const card = document.createElement('section');
    card.className = 'roomCard';
    card.id = `card-${room.id}`;

    card.innerHTML = `
      <div class="roomInner">
        <div class="photo">
          <img alt="${room.name}" />
          <div class="pArrow left" title="Previous photo">‹</div>
          <div class="pArrow right" title="Next photo">›</div>
          <div class="photoBadge">${room.name} • ${fmtMoney(room.pricePerNight, DATA.currencySymbol || '$')}</div>
        </div>

        <div class="infoSide">
          <div class="titleRow">
            <h2 class="roomTitle">${room.name}</h2>
            <div class="pricePill">${fmtMoney(room.pricePerNight, DATA.currencySymbol || '$')}</div>
          </div>

          <div class="subBox">
            <div><span style="color:rgba(255,255,255,.7)">Info:</span> <b>${room.info}</b></div>
          </div>

          <div class="calMount"></div>
        </div>
      </div>
    `;

    // Photo carousel
    const img = card.querySelector('.photo img');
    const prev = card.querySelector('.pArrow.left');
    const next = card.querySelector('.pArrow.right');
    const imgs = (room.images && room.images.length) ? room.images : [''];
    let i = 0;
    const setImg = ()=>{
      img.src = imgs[i] || '';
    };
    setImg();

    prev.addEventListener('click', ()=>{ i = (i - 1 + imgs.length) % imgs.length; setImg(); });
    next.addEventListener('click', ()=>{ i = (i + 1) % imgs.length; setImg(); });

    // Calendar mount
    const calMount = card.querySelector('.calMount');
    createCalendar(calMount, room);

    roomsEl.appendChild(card);
  });

  // thumb controls
  const step = 320;
  document.getElementById('thumbLeft').onclick = ()=> rail.scrollLeft -= step;
  document.getElementById('thumbRight').onclick = ()=> rail.scrollLeft += step;

  startSlowThumbAutopan();
}

/* ===============================
   Boot
================================ */
(async function init(){
  const res = await fetch('./rooms.json', {cache:'no-store'});
  DATA = await res.json();
  renderRooms();
})();
</script>
</body>
</html>
